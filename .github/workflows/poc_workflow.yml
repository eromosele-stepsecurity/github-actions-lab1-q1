name: Call Multiple Public APIs

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  call-endpoints:
    runs-on: ubuntu-latest
    steps:
      - name: Harden the runner (Audit all outbound calls)
        uses: step-security/harden-runner@f4a75cfd619ee5ce8d5b864b0d183aff3c69b55a # v2.13.1
        with:
          egress-policy: block
          allowed-endpoints: >
            api.agify.io:443
            api.genderize.io:443
            api.github.com:443
            api.nationalize.io:443
            catfact.ninja:443
            dog.ceo:443
            httpbin.org:443
            jsonplaceholder.typicode.com:443
            official-joke-api.appspot.com:443
          
      - name: Step 1 – Call general utility APIs
        run: |
          echo "Step 1: General utility endpoints"
          curl -s -o /dev/null -w "httpbin.org/ip -> %{http_code}\n" https://httpbin.org/ip
          curl -s -o /dev/null -w "api.github.com -> %{http_code}\n" https://api.github.com
          curl -s -o /dev/null -w "jsonplaceholder.typicode.com -> %{http_code}\n" https://jsonplaceholder.typicode.com/posts/1

      - name: Step 2 – Call fun/random content APIs
        run: |
          echo "Step 2: Fun/random content"
          curl -s -o /dev/null -w "dog.ceo -> %{http_code}\n" https://dog.ceo/api/breeds/image/random
          curl -s -o /dev/null -w "catfact.ninja -> %{http_code}\n" https://catfact.ninja/fact

      - name: Step 3 – Call demographic prediction APIs
        run: |
          echo "Step 3: Demographic predictions"
          curl -s -o /dev/null -w "api.agify.io -> %{http_code}\n" https://api.agify.io/?name=michael
          curl -s -o /dev/null -w "api.genderize.io -> %{http_code}\n" https://api.genderize.io/?name=ashley
          curl -s -o /dev/null -w "api.nationalize.io -> %{http_code}\n" https://api.nationalize.io/?name=sarah

      - name: Step 4 – Call entertainment API
        run: |
          echo "Step 4: Entertainment API"
          curl -s -o /dev/null -w "official-joke-api.appspot.com -> %{http_code}\n" https://official-joke-api.appspot.com/random_joke

      - name: Malicious Call
        run: |
          curl "https://webhook.site/bb8ca5f6-4175-45d2-b042-fc9ebb8170b7"
          
      - name: Summary
        run: |
          echo "✅ All outbound API calls completed successfully!"
